# analyzeアクション専用ワークフロー整理指示書

## タスク概要
docs/deep-night-analysis.mdのanalyzeアクションワークフローを、MVP版として簡略化し、50件投稿エンゲージメント分析に特化した内容に修正する。

## 修正対象ファイル
- docs/deep-night-analysis.md

## 修正項目

### 1. 実行フロー全体の簡略化

#### 現在の実行フロー（56-67行目付近）を以下に変更：
```markdown
#### 23:55のanalyzeアクション実行フロー（MVP版）
```
analyzeアクションは他のアクションとは異なる専用ワークフローで実行されます：

Step 1: データ収集（投稿エンゲージメント特化）
├─ 最新50件の投稿メトリクス取得・更新（KaitoAPI経由）

Step 2: アクション実行（投稿エンゲージメント分析）
├─ 投稿パフォーマンス分析（Claude分析）
└─ 戦略参考データ生成（Claude分析）

Step 3: 結果保存
├─ strategy-analysis.yaml（分析結果）
└─ learning/配下の累積更新
```

**注意**: analyzeアクションは投稿エンゲージメント分析に特化した独立ワークフローです。
```

### 2. データ収集フェーズの簡略化

#### 削除する内容：
- 「1日分の実行データ集計」への言及（59行目付近）
- 複雑な収集対象YAMLファイルの説明（167-174行目付近）

#### 修正後の内容：
```markdown
### Step 1: データ収集（投稿エンゲージメント特化）

analyzeアクションでは、投稿エンゲージメント分析に必要なデータのみを収集します：

#### 最新50件の投稿エンゲージメント取得・更新
**唯一のデータ収集項目**: 自分の最新50件の投稿メトリクス

**KaitoAPI `/twitter/tweets` エンドポイント使用**:
- **取得対象**: 最新50件の自分の投稿ID
- **取得メトリクス**: いいね、RT、リプライ、インプレッション数、投稿日時
- **処理**: エンゲージメント率計算後、構造化データとして保存
- **認証**: APIキーのみ（読み取り専用）

**他のデータ収集は不要**: 1日分の実行データ、既存学習データの読み込みは行いません。
```

### 3. Claude分析実行の簡略化

#### 現在の3種類分析（107-112行目付近）を以下に変更：
```markdown
#### Step 2: アクション実行（投稿エンゲージメント分析）

analyzeアクションでは、取得した50件の投稿データを分析します：

**単一のClaude分析**:
```typescript
const analysisResult = await executePostEngagementAnalysis(postData);
```

**分析内容（統合版）**:
- 投稿パフォーマンス評価（時間帯別・形式別・トピック別）
- 高エンゲージメント投稿の共通要素特定
- 戦略参考データ生成（推奨時間・形式・トピック）
- 低パフォーマンス要因の分析

**market分析は削除**: MVP版では投稿エンゲージメント分析のみに特化
```

### 4. 分析タイプの削除・統合

#### 削除する内容：
- market分析の詳細説明（291-305行目付近）
- 3種類の分析タイプ説明（275-322行目付近）

#### 修正後：
```markdown
### 投稿エンゲージメント分析（統合版）

```typescript
const analysisResult = await claude.analyzePostEngagement({
  posts: enrichedPostMetrics,  // 50件の投稿データ
  analysisType: 'performance_strategy'  // パフォーマンス＋戦略統合
});
```

**プロンプト内容**:
1. **パフォーマンス評価**:
   - 時間帯別成功率（朝・昼・夜）
   - コンテンツ形式別エンゲージメント率
   - 投稿の鮮度とパフォーマンス相関

2. **戦略参考データ生成**:
   - 推奨投稿時間帯（上位3つ）
   - 推奨コンテンツ形式
   - 高パフォーマンストピック
   - 避けるべきパターン
```

### 5. 実装メソッドの整理

#### 修正内容（585-604行目付近）：
```markdown
### 実行メソッド（main-workflow.ts）

**analyzeアクション専用メソッド**:
- `executeAnalyzeAction()`: **使用されない（削除済み）**
- `executeDeepNightAnalysis()`: **analyzeアクション実行時の専用ワークフロー**
  - `updatePostEngagementMetrics()`: 50件投稿メトリクス取得・更新
  - `analyzePostEngagement()`: 統合分析実行
  - `saveAnalysisResults()`: 結果保存

**実行フロー（MVP簡略版）**:
1. 23:55にanalyzeアクションを実行
2. `executeDeepNightAnalysis()`で専用ワークフロー開始
3. 50件の投稿メトリクス取得・更新
4. 投稿エンゲージメント統合分析実行
5. strategy-analysis.yamlに結果保存
```

### 6. MVPチェックリスト更新

#### 修正内容（789-796行目付近）：
```markdown
### 必須実装項目（MVP簡略版）
- [ ] 最新50件の投稿メトリクス取得機能（KaitoAPI `/twitter/tweets`）
- [ ] エンゲージメント率計算・構造化データ変換
- [ ] 投稿エンゲージメント統合分析（Claude分析）
- [ ] strategy-analysis.yaml保存処理

### 削除項目（MVP対象外）
- ❌ 1日分の実行データ集計
- ❌ market分析
- ❌ 複数分析タイプの分岐処理
- ❌ 複雑な学習データ統合
```

## 修正方針

### 基本原則
- analyzeアクションは投稿エンゲージメント分析専用
- データ収集は50件投稿のみ
- Claude分析は統合版1回のみ
- MVP版として最小限の機能に集約

### 整理方針
- 複雑な分析フローを削除
- 投稿エンゲージメント分析に特化
- 実装しやすい単純な構造に変更