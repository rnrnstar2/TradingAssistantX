# 深夜分析独立アクション化指示書

## タスク概要
docs/deep-night-analysis.mdの深夜分析を「通常ワークフローの追加ステップ」ではなく「独立したアクション」として修正する。

## 修正対象ファイル
- docs/deep-night-analysis.md（主要修正対象）

## 修正項目

### 1. 基本概念の修正

#### 現状の問題
- 「通常ワークフローの完了後に追加実行される」という誤った記述
- 「Step 4」としての位置づけ
- 「追加ステップ」という表現

#### 修正内容
- 深夜分析は`analyze`アクションとして他のアクション（post、retweet等）と同等の独立したアクション
- schedule.yamlで23:55に設定される1つのアクション
- 通常ワークフローとは独立して実行される

### 2. 実行フローの再定義

#### 修正後の記述例
```
深夜分析（analyzeアクション）は、schedule.yamlで23:55に設定される独立したアクションです。
他のアクション（post、retweet、like等）と同様に、3ステップのワークフローで実行されます：

Step 1: データ収集（分析用データの収集）
Step 2: アクション実行（深夜分析の実行）
Step 3: 結果保存（分析結果の保存）
```

### 3. 実装方法の修正

#### 削除すべき内容
- 「通常ワークフロー完了後」という表現
- 「追加ステップ」という表現
- 「Step 4」という番号付け

#### 修正すべき内容
```typescript
// schedule.yamlでの設定例
- time: "23:55"
  action: "analyze"
  params: {}

// ワークフローでの実行
switch (action) {
  case 'post':
    await this.executePostAction();
    break;
  case 'analyze':
    await this.executeAnalyzeAction();  // 深夜分析実行
    break;
  // 他のアクション...
}
```

### 4. KaitoAPI更新対応

#### 修正内容
- `getTweetsByIds`への言及を`/twitter/tweets`エンドポイントに修正
- エンドポイントURL: `GET /twitter/tweets?tweet_ids=id1,id2,id3...`
- パラメータ名の修正（tweet.fields → 不要、エンドポイントが自動的に全メトリクス返却）

### 5. 図表・フローチャートの修正

#### 修正内容
- 23:55実行フローから「通常ワークフロー + 深夜分析」という表現を削除
- 単純に「analyzeアクション実行」として表現
- タイミングチャートも同様に修正

## 実装要件

### 記述の統一
- 深夜分析 = analyzeアクション（独立したアクション）
- 他のアクション（post、retweet等）と同列の扱い
- schedule.yamlで時刻指定される通常のアクション

### 削除すべき記述
- 「通常ワークフローの後に」
- 「追加ステップ」
- 「Step 4」
- 「特別な処理」

### 整合性確認
- workflow.mdの記述（analyzeアクションは他のアクションと同列）と一致させる
- 実装状況（未実装）は明記を継続