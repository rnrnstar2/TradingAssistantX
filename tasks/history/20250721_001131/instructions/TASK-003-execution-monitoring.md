# TASK-003: 実行監視・ヘルスチェック機能

## 🎯 実装目的

**健全な定期実行ワークフロー**の完成：
- 実行状況の基本監視（MVP範囲内）
- システムヘルスチェック（最小限）
- リソース枯渇の予防的検出

## 🚨 MVP制約（必須遵守）

### 絶対禁止
- **詳細な統計分析** - CPU使用率、メモリ詳細等の複雑分析禁止
- **高度な監視システム** - Prometheus、Grafana等の外部ツール禁止
- **アラートシステム** - 複雑な通知機構、エスカレーション禁止
- **パフォーマンスチューニング** - 自動最適化、ベンチマーク禁止

### 実装範囲
**最小限の監視機能のみ**：
1. 基本的なシステム状態確認
2. ディスク容量簡易チェック
3. 実行可能性の判定

## 📋 実装対象

### 1. 基本ヘルスチェック機能
**ファイル**: `scripts/monitoring/health-check.ts`

**機能**（最小限）：
- **ディスク容量**: 使用可能容量の簡易確認（1GB未満で警告）
- **プロセス状態**: 主要プロセスの生存確認
- **データ整合性**: 重要設定ファイルの存在確認

### 2. package.json コマンド追加
```json
{
  "scripts": {
    "health": "tsx scripts/monitoring/health-check.ts",
    "status:full": "tsx scripts/monitoring/health-check.ts --verbose"
  }
}
```

### 3. 自動ヘルスチェック統合
**統合場所**: `src/core/autonomous-executor.ts`

**統合方法**：
- 実行開始前の簡易チェック
- 深刻な問題発見時のみ実行停止

## 🔧 実装要件

### 1. ヘルスチェック機能
**基本チェック項目**：
```typescript
interface HealthStatus {
  diskSpace: 'ok' | 'warning' | 'critical';
  dataFiles: 'ok' | 'missing' | 'corrupted';
  processes: 'running' | 'stopped';
  overall: 'healthy' | 'warning' | 'critical';
}
```

**判定基準**（シンプル）：
- **ディスク**: 1GB未満で警告、500MB未満で重要
- **データファイル**: YAML設定ファイルの存在確認のみ
- **プロセス**: 単純な実行状態確認

### 2. 統合レベル（最小限）
- **実行前チェック**: 基本状態確認のみ
- **Critical時のみ停止**: 重大問題以外は継続実行
- **ログ出力のみ**: 複雑なアクション禁止

### 3. エラー処理（シンプル）
- チェック失敗時はログ出力のみ
- システム全体の停止は回避
- **自動修復禁止**

## 🛡️ 安全性要件

### データ保護
1. **読み取り専用**: ファイルの読み取りのみ、変更禁止
2. **設定ファイル保護**: チェック中の意図しない変更を防止
3. **軽量実行**: システムリソースへの影響最小化

### 失敗時の継続性
- ヘルスチェック失敗でもシステム継続
- 警告レベルでは実行停止しない
- **過剰な警告表示禁止**

## 📂 出力管理（強制遵守）

### 出力先
- **ヘルスログ**: `tasks/20250721_001131/outputs/TASK-003-health-log.txt`
- **一時ファイル**: `tasks/20250721_001131/outputs/`

### 禁止出力先
- **ルートディレクトリ直下**は絶対禁止
- **詳細分析レポート**の作成禁止

## ✅ 実装手順

1. **ヘルスチェックスクリプト作成**
   - 基本的なシステム状態確認
   - シンプルな判定ロジック
   - JSON形式での状態出力

2. **AutonomousExecutor統合**
   - 実行開始前の軽量チェック
   - Critical時のみの実行停止

3. **package.json更新**
   - 手動ヘルスチェック用コマンド追加

4. **統合テスト**
   - 正常時・警告時・エラー時の動作確認

## 🚫 実装禁止事項

- **CPU/メモリ詳細監視**
- **ネットワーク監視**
- **外部サービス監視**
- **自動修復機能**
- **複雑なしきい値設定**
- **通知・アラート機能**
- **履歴分析機能**

## 🎯 成功基準

1. **基本ヘルスチェック動作** - 簡単な状態確認が可能
2. **Critical時の適切停止** - 深刻な問題時のみシステム停止
3. **軽量実行** - システムリソースへの影響最小化
4. **MVP制約完全遵守** - 過剰機能の完全除外

## 📋 報告書要件

**報告書**: `tasks/20250721_001131/reports/REPORT-003-execution-monitoring.md`

**含める内容**：
- 実装されたヘルスチェック機能
- 統合されたチェックポイント
- テスト結果と基本動作確認
- Critical判定の基準

**含めない内容**：
- 詳細なパフォーマンス分析
- システムリソース統計
- 将来の監視拡張計画

---

**重要**: これで**健全な定期実行ワークフロー**が完成し、データ蓄積問題の解決と基本的なシステム安定性が確保されます。