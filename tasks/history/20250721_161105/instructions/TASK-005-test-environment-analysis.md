# TASK-005: テスト環境分析・テスト構造とカバレッジチェック

## 🎯 タスク概要
プロジェクト全体のテスト環境・テストファイル構造・テストカバレッジを調査し、テスト戦略の整合性・品質・完成度を評価して改善提案を作成する。

## 🔍 調査対象領域

### 1. テストファイル構造調査（最重要）

**現在のテスト構造**：
```
tests/
├── integration/（統合テスト）
│   ├── action-specific-integration.test.ts（新規）
│   ├── optimized-workflow.test.ts
│   └── playwright-parallel-execution.test.ts
└── unit/（単体テスト）
    ├── action-specific-collector.test.ts（新規）
    ├── parallel-execution.test.ts
    └── playwright-browser-manager.test.ts
```

**CLAUDE.mdで定義されたテスト原則**：
- **配置統一**: 全テストファイルはtests/ディレクトリに統一配置
- **形式統一**: *.test.ts形式
- **実行環境**: Vitestを使用（pnpm test / pnpm test:watch）
- **テスト方針**: 重要ロジックのみ（E2E除外）

### 2. テスト設定・環境調査

**テスト設定ファイル**：
```
📋 調査対象設定：
- vitest.config.ts（Vitest設定）
- vitest.setup.ts（セットアップ）
- tsconfig.json（TypeScript設定）
- package.json（テストスクリプト）
```

**調査ポイント**：
- Vitest設定の適切性
- TypeScriptとの統合状況
- テストスクリプトの完成度
- カバレッジ設定の有無

### 3. 新規テストファイル品質調査

**新規作成テストファイル**：
```
🆕 重点調査対象：
- tests/integration/action-specific-integration.test.ts
- tests/unit/action-specific-collector.test.ts
```

**品質評価項目**：
- テストケースの網羅性
- モック・スタブの適切性
- エラーケースのテスト
- パフォーマンステスト
- 非同期処理のテスト品質

### 4. テストカバレッジ分析

**実装ファイル vs テストファイル対応**：
```
🔍 カバレッジ調査対象：
src/core/
├── autonomous-executor.ts → テスト: ？
├── decision-engine.ts → テスト: ？
└── parallel-manager.ts → テスト: parallel-execution.test.ts

src/lib/
├── action-specific-collector.ts → テスト: action-specific-collector.test.ts
├── playwright-browser-manager.ts → テスト: playwright-browser-manager.test.ts
├── claude-agent.ts → テスト: ？
├── x-client.ts → テスト: ？
└── その他20+ファイル → テスト: ？
```

**調査内容**：
- 重要ロジックのテストカバレッジ
- テスト不足の重要ファイル特定
- 過剰テスト・不要テストの特定

### 5. テスト実行・CI/CD統合状況

**テスト実行環境**：
- ローカル実行の安定性
- 並列実行の対応状況
- モック環境の整備状況
- 外部依存の分離状況

## 🛠️ 実行手順

### Phase 1: テスト設定ファイル分析
1. **vitest.config.ts詳細読み込み**
2. **設定の適切性評価**
3. **TypeScript統合確認**
4. **package.jsonスクリプト確認**

### Phase 2: テストファイル構造・品質評価
1. **全テストファイルの詳細読み込み**
2. **テストケース品質評価**：
   - 正常系・異常系のカバー
   - モック使用の適切性
   - アサーションの妥当性
3. **新規テストファイル特別調査**

### Phase 3: テストカバレッジマッピング
1. **実装ファイル vs テストファイル対応表作成**
2. **重要ロジックのテスト状況確認**
3. **テスト不足・過剰の特定**

### Phase 4: テスト実行環境評価
1. **ローカルテスト実行確認**
2. **並列実行・パフォーマンステスト**
3. **外部依存モック状況評価**

### Phase 5: テスト戦略整合性確認
1. **CLAUDE.mdテスト方針準拠度**
2. **実用性重視原則との整合性**
3. **品質重視方針の実現度**

## 📋 成果物要件

### 必須成果物
1. **テスト環境設定評価レポート**：
   - vitest.config.ts設定の適切性評価
   - 設定改善提案
   - 実行環境の問題点・改善案

2. **テストファイル品質分析**：
   - 各テストファイルの品質評価（A/B/C/D）
   - 新規テストファイルの詳細分析
   - テストケース改善提案

3. **テストカバレッジ分析レポート**：
   - 実装ファイル vs テスト対応マップ
   - 重要ロジックのテスト不足リスト
   - テストカバレッジ向上優先順位

4. **テスト戦略整合性評価**：
   - CLAUDE.mdテスト方針準拠度（0-100%）
   - テスト方針違反箇所の特定
   - テスト戦略最適化提案

5. **テスト改善ロードマップ**：
   - 短期改善項目（1-2週間）
   - 中期改善項目（1-2ヶ月）
   - 長期テスト戦略（3ヶ月+）

## ⚠️ 重要な制約・注意事項

### 🚫 **テストファイル編集禁止**
- **テストコードの修正・作成は一切禁止**
- **テスト設定ファイルの修正は禁止**
- **調査・分析・提案作成のみ実行**

### ✅ **実用性重視テスト評価**
- **重要ロジック優先**：E2E除外方針準拠
- **保守性重視**：テストの理解しやすさ・修正しやすさ
- **実行効率**：テスト実行時間・並列性
- **実装支援**：開発効率向上への貢献度

### 📂 **出力管理規則厳格遵守**
- **出力場所**: `tasks/20250721_161105/reports/` のみ
- **ファイル命名**: `REPORT-005-test-environment-analysis.md`
- **補助資料**: テストカバレッジマップのYAML/JSON形式レポート

### 🔧 **調査手法**
- **Grepツール**：テスト対象の実装ファイル検索
- **実行テスト**：pnpm test実行での問題確認
- **依存関係分析**：テストファイル間・実装との関係

## 🎯 期待される価値
1. **品質保証**：テストによる信頼性確保
2. **開発効率**：適切なテスト環境による生産性向上
3. **保守性向上**：テストによるリファクタリング安全性
4. **実用性確保**：過不足ないテストカバレッジ

---

**成功基準**: 実用性重視のテスト戦略に基づいた、効率的で効果的なテスト環境の最適化案を提示すること