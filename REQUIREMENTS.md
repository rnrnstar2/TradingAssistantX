# TradingAssistantX MVP要件定義書

## 🎯 MVPビジョン

**シンプルなX投稿自動化システム**
- 🚀 **30分間隔自動実行**: KaitoAPIを使った定期投稿システム
- 🎓 **投資教育コンテンツ**: 投資・トレードに関する教育的な投稿
- 🤖 **Claude判断**: Claude SDKによる最適なアクション決定
- 📚 **学習機能**: 実行結果を学習データとして蓄積・活用

## 💡 MVPの基本目標

### シンプル実行フロー
```
30分毎の自動実行:
1. 【データ読み込み】
   - DataManager: 設定・学習データ読み込み
   - KaitoAPI: アカウント状況確認

2. 【Claude判断】
   - 現在状況の分析
   - 最適なアクション決定（投稿/RT/いいね/待機）

3. 【アクション実行】
   - 決定されたアクションの実行
   - 基本的なエラーハンドリング

4. 【結果記録】
   - 実行結果の記録
   - 学習データの更新
```

### 成功指標
- **🎯 継続実行**: 30分間隔での安定した自動実行
- **🤖 適切判断**: Claudeによる状況に応じた適切なアクション選択
- **📚 学習蓄積**: 実行結果の記録と次回実行への活用

## 🏗️ MVP システムアーキテクチャ

### シンプル設計
**動作確実性を最優先とした基本構成**

```
シンプル実装 > 複雑な設計
確実な動作 > 高度な機能
```

### 30分間隔実行システム
```
CoreScheduler (30分間隔)
     ↓
DataManager (設定・学習データ読み込み)
     ↓
ClaudeDecisionEngine (アクション決定)
     ↓
ActionExecutor (基本的なアクション実行)
     ↓
結果記録・学習データ更新
```

## 🤖 Claude Code SDK アクション決定

### 判断形式
```typescript
interface ClaudeDecision {
  action: 'post' | 'retweet' | 'quote_tweet' | 'like' | 'wait';
  reasoning: string;           // 判断理由
  parameters: {
    topic?: string;           // 投稿トピック
    searchQuery?: string;     // 検索クエリ
    content?: string;         // 生成内容
    targetTweetId?: string;   // 対象投稿
  };
  confidence: number;         // 確信度
}
```

### アクション種別

#### 1. 投稿 (post)
- **フロー**: トピック決定→内容生成→投稿実行
- **判断基準**: フォロワー状況、前回投稿からの時間、市場トレンド
- **内容生成**: Claude + 学習データ活用

#### 2. リツイート (retweet)  
- **フロー**: 検索クエリ生成→投稿検索→候補分析→RT実行
- **検索条件**: 投資教育関連、高エンゲージメント、信頼性
- **選択基準**: 教育価値、アカウント戦略適合性

#### 3. 引用リツイート (quote_tweet)
- **フロー**: 検索→Claude評価→引用価値判断→コメント生成→実行
- **評価観点**: 教育価値、追加価値、フォロワー有益性
- **コメント生成**: 独自視点・補足説明の追加

#### 4. いいね (like)
- **フロー**: 対象検索→品質評価→いいね実行
- **対象基準**: 高品質投資教育コンテンツ、戦略合致
- **頻度制御**: 適切な間隔でのいいね実行

#### 5. 待機 (wait)
- **条件**: 適切なアクションがない場合、頻度制御
- **効果**: 次回30分後の実行継続

## 📁 ディレクトリ・ファイル構造（MVP版）

### /src ディレクトリ（Claude強み活用アーキテクチャ版）
**20ファイル・6ディレクトリ構成 - Claude SDK価値最大化設計（MVP+Claude強み）**

```
src/
├── claude/                    # Claude Code SDK関連 (5ファイル - Claude強み活用設計)
│   ├── decision-engine.ts     # 高度なアクション決定・状況判断 (120行程度)
│   ├── content-generator.ts   # AI駆動投稿生成・品質確保 (100行程度)
│   ├── performance-tracker.ts # 簡潔なパフォーマンス分析・学習 (100行程度)
│   ├── market-analyzer.ts     # 基本的な市場コンテキスト分析 (80行程度)
│   └── prompt-builder.ts      # Claude用プロンプト最適化 (80行程度)
│
├── kaito-api/                 # KaitoTwitterAPI基本構成 (6ファイル - MVP必須機能)
│   ├── client.ts              # API認証・基本リクエスト管理
│   ├── config.ts              # API設定・エンドポイント管理
│   ├── search-engine.ts       # 投稿検索・トレンド取得
│   ├── tweet-actions.ts       # 投稿・RT・いいね実行
│   ├── user-info.ts           # アカウント情報取得
│   └── response-handler.ts    # レスポンス処理・エラーハンドリング
│
├── scheduler/                 # スケジュール制御 (2ファイル)
│   ├── core-scheduler.ts      # 30分間隔制御
│   └── main-loop.ts           # メイン実行ループ統合
│
├── data/                      # データ管理統合 (8ファイル)
│   ├── data-manager.ts        # データ管理クラス
│   ├── config/                # システム設定
│   │   └── api-config.yaml   # KaitoTwitterAPI認証設定
│   ├── learning/              # 学習データ（Claude判断材料）
│   │   ├── decision-patterns.yaml    # 過去の判断パターンと結果
│   │   ├── success-strategies.yaml   # 成功戦略の記録
│   │   └── action-results.yaml       # アクション結果履歴
│   └── context/               # 実行コンテキスト
│       ├── session-memory.yaml       # セッション間引き継ぎ
│       └── current-status.yaml       # 現在の実行状況
│
├── shared/                    # 共通機能 (3ファイル)
│   ├── types.ts               # 型定義統合
│   ├── config.ts              # 設定管理
│   └── logger.ts              # ログ管理
│
└── main.ts                    # システム起動スクリプト (1ファイル)
```

**Claude強み活用アーキテクチャの利点**:
- **Claude価値最大化**: AI判断・学習能力を適切に活用
- **簡潔な高機能**: 過剰でない範囲で必要な分析機能を実装
- **学習改善サイクル**: パフォーマンス追跡による継続改善
- **バランス設計**: シンプルさとClaude強みの両立
- **実用性重視**: MVPでも価値を発揮できる機能構成

### KaitoTwitterAPI基本仕様（MVP版）
**MVP必須機能のみ実装**:
- **認証・接続**: 基本的なAPI認証
- **投稿検索**: シンプルな投稿検索・トレンド取得
- **基本アクション**: 投稿・RT・いいね・アカウント情報取得

**実装機能**:
1. **client.ts**: API認証・基本リクエスト
2. **search-engine.ts**: 投稿検索・トレンド取得
3. **tweet-actions.ts**: 投稿・RT・いいね実行
4. **user-info.ts**: アカウント情報取得

### データ管理方針
**data/ ディレクトリによる基本管理**
- 設定とデータの統合管理
- 学習データの蓄積と活用
- シンプルなYAML形式での保存

## 🚀 基本的なワークフロー（30分毎）

### メインループ実行順序
1. **スケジューラー起動**: 30分間隔でのシステム実行開始
2. **データ確認**: dataディレクトリから学習データ・設定読み込み
3. **状況分析**: アカウント状況・市場動向・過去データの統合分析
4. **Claude判断**: 現在状況に基づく最適アクションの決定
5. **アクション実行**: 決定されたアクション（投稿・RT・いいね等）の実行
6. **結果記録**: 実行結果の記録・学習データへの反映
7. **次回待機**: 30分後の次回実行まで待機

### エラーハンドリング
- **基本的なtry-catch実装**
- **エラー時は次回実行に継続**
- **基本的なエラーログ記録**

## 🎯 MVPの成功基準

### 基本機能要件
- [ ] **30分間隔自動実行**: 定期的な自動実行システム
- [ ] **Claude判断機能**: アクション決定システム
- [ ] **KaitoAPI連携**: 基本的なAPI操作機能
- [ ] **学習データ保存**: 実行結果の記録・活用

### 動作確認要件
- [ ] **継続実行**: 30分間隔での安定動作
- [ ] **アクション実行**: 投稿・RT・いいね・待機の正常実行
- [ ] **データ更新**: 実行結果の学習データ反映
- [ ] **エラー処理**: 基本的なエラー対応と継続実行

## 💡 実装戦略

### 実装ステップ
1. **基本構造作成**: 必要なファイル・ディレクトリ作成
2. **データ管理実装**: 設定・学習データの読み書き機能
3. **KaitoAPI基本機能**: API認証・基本操作実装
4. **Claude判断機能**: アクション決定ロジック実装
5. **スケジューラー実装**: 30分間隔実行機能
6. **統合テスト**: 全体動作確認・デバッグ

### 実装優先度（MVP版）
- **最優先**: 30分間隔実行・基本的なClaude判断・KaitoAPI基本連携
- **必須**: シンプルな学習データ保存・基本エラーハンドリング
- **追加**: 基本ログ出力

### MVP後の段階的拡張
- コンテンツ品質向上機能
- より詳細な学習データ活用
- 基本的なパフォーマンス追跡機能

## 🔒 制約事項

### Claude強み活用MVP制限
- **🚫 過剰詳細分析禁止**: 7指標品質評価、詳細エンゲージメント予測などは実装しない
- **✅ バランス重視**: 動作確実性とClaude価値の両立
- **📏 ファイル数制限**: src/claude 5ファイル、src/kaito-api 6ファイルを厳守（各ファイル80-120行）
- **🤖 Claude価値活用**: AI判断・学習・品質評価の基本機能は実装

### Claude強み活用MVP要件
- **30分間隔実行**: システムの基本動作
- **高度なClaude判断**: 状況分析に基づく適切なアクション決定
- **基本的なKaitoAPI操作**: 投稿・検索・RT・いいね
- **パフォーマンス学習**: 簡潔な結果分析と継続改善
- **品質確保**: 基本的な投稿品質チェック