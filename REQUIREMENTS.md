# TradingAssistantX MVP要件定義書 - コア機能実装版

## 🎯 MVPビジョン

**30分間隔自動実行によるX投稿システム**
- 🔄 **定期自動実行**: 30分間隔でのClaudeによる自律判断・アクション実行
- 📊 **データドリブン判断**: dataディレクトリの学習データに基づく賢い意思決定
- 🤖 **多様なアクション**: 投稿・リツイート・引用リツイート・いいねの統合実行
- 📈 **継続学習**: 実行結果の蓄積による戦略自動進化

**コア技術**: Claude Code SDK + KaitoTwitterAPI による30分間隔自動実行システム

## 💡 MVPの現実的な目標

### 基本動作フロー
```
30分毎の自動実行:
1. dataディレクトリ確認・読み込み
2. Claude Code SDKによるアクション決定
3. アクション別処理実行:
   - 投稿: 内容作成→投稿
   - リツイート: 検索→RT
   - 引用リツイート: 検索→Claude判断→引用RT
   - いいね: 検索→いいね
4. 結果記録・学習データ更新
```

### 成功指標
- **実行安定性**: 30分間隔での確実な自動実行
- **アクション多様性**: 投稿・RT・引用RT・いいねの適切な選択
- **品質維持**: Claude判断による高品質なコンテンツ・アクション
- **継続学習**: 実行結果の蓄積による戦略改善

## 🏗️ MVP システムアーキテクチャ

### 実用最優先設計
**シンプルで確実に動作する12ファイル構成**

```
動作確実性 > Clean Architecture の複雑さ
実装速度 > 理論的完璧性
```

### 30分間隔実行システム
```
CoreScheduler (30分間隔)
     ↓
DataManager (data確認)
     ↓
ClaudeDecisionEngine (アクション決定)
     ↓
ActionExecutor (実行)
     ↓
結果記録・学習データ更新
```

## 🤖 Claude Code SDK アクション決定

### 判断形式
```typescript
interface ClaudeDecision {
  action: 'post' | 'retweet' | 'quote_tweet' | 'like' | 'wait';
  reasoning: string;           // 判断理由
  parameters: {
    topic?: string;           // 投稿トピック
    searchQuery?: string;     // 検索クエリ
    content?: string;         // 生成内容
    targetTweetId?: string;   // 対象投稿
  };
  confidence: number;         // 確信度
}
```

### アクション種別

#### 1. 投稿 (post)
- **フロー**: トピック決定→内容生成→投稿実行
- **判断基準**: フォロワー状況、前回投稿からの時間、市場トレンド
- **内容生成**: Claude + 学習データ活用

#### 2. リツイート (retweet)  
- **フロー**: 検索クエリ生成→投稿検索→候補分析→RT実行
- **検索条件**: 投資教育関連、高エンゲージメント、信頼性
- **選択基準**: 教育価値、アカウント戦略適合性

#### 3. 引用リツイート (quote_tweet)
- **フロー**: 検索→Claude評価→引用価値判断→コメント生成→実行
- **評価観点**: 教育価値、追加価値、フォロワー有益性
- **コメント生成**: 独自視点・補足説明の追加

#### 4. いいね (like)
- **フロー**: 対象検索→品質評価→いいね実行
- **対象基準**: 高品質投資教育コンテンツ、戦略合致
- **頻度制御**: 適切な間隔でのいいね実行

#### 5. 待機 (wait)
- **条件**: 適切なアクションがない場合、頻度制御
- **効果**: 次回30分後の実行継続

## 📁 ディレクトリ・ファイル構造（MVP版）

### /src ディレクトリ（機能別分類版）
**19ファイル・6ディレクトリ構成 - 機能別責務分離（データ統合版）**

```
src/
├── claude/                    # Claude Code SDK関連 (3ファイル)
│   ├── decision-engine.ts     # アクション決定エンジン
│   ├── content-generator.ts   # 投稿内容生成
│   └── post-analyzer.ts       # 投稿分析・品質評価
│
├── kaito-api/                 # KaitoTwitterAPI関連 (3ファイル)
│   ├── client.ts              # KaitoTwitterAPIクライアント（認証・QPS制御）
│   ├── search-engine.ts       # 投稿検索エンジン（Tweet・User・Trend対応）
│   └── action-executor.ts     # アクション実行統合（7エンドポイント対応）
│
├── scheduler/                 # スケジュール制御 (2ファイル)
│   ├── core-scheduler.ts      # 30分間隔制御
│   └── main-loop.ts           # メイン実行ループ統合
│
├── data/                      # データ管理統合 (8ファイル)
│   ├── data-manager.ts        # データ管理クラス
│   ├── config/                # システム設定
│   │   └── api-config.yaml   # KaitoTwitterAPI認証設定
│   ├── learning/              # 学習データ（Claude判断材料）
│   │   ├── decision-patterns.yaml    # 過去の判断パターンと結果
│   │   ├── success-strategies.yaml   # 成功戦略の記録
│   │   └── action-results.yaml       # アクション結果履歴
│   └── context/               # 実行コンテキスト
│       ├── session-memory.yaml       # セッション間引き継ぎ
│       └── current-status.yaml       # 現在の実行状況
│
├── shared/                    # 共通機能 (3ファイル)
│   ├── types.ts               # 型定義統合
│   ├── config.ts              # 設定管理
│   └── logger.ts              # ログ管理
│
└── main.ts                    # システム起動スクリプト (1ファイル)
```

**機能別分離の利点**:
- **Claude系集約**: AI判断機能の独立性・プロンプト管理統一
- **KaitoAPI系集約**: API通信機能統一・外部依存局所化
- **スケジュール系分離**: 実行制御の明確化・タイミング管理統一
- **保守性向上**: 問題箇所の特定容易・機能追加時の影響局所化

### KaitoTwitterAPI統合仕様
**API特性**:
- **高性能**: 平均応答時間700ms、最大200QPS対応
- **コスト効率**: $0.15/1k tweets、最小$0.00015/リクエスト
- **安定性**: 100万+API呼び出し実績

**対応エンドポイント**（7カテゴリ）:
1. User Endpoints - プロフィール・フォロワー取得
2. Tweet Endpoints - 投稿取得・分析
3. Communities Endpoints - コミュニティ機能
4. List Endpoints - リスト管理
5. Trend Endpoints - トレンド分析
6. Login Endpoints - 認証・ログイン
7. Tweet Action Endpoints - 投稿・RT・いいね実行

**MVP後の拡張考慮**:
```
kaito-api/
├── client.ts
├── search-engine.ts
├── action-executor.ts     # MVP版：統合実行
└── [将来拡張]
    ├── actions/
    │   ├── tweet-actions.ts    # 投稿・RT・いいね
    │   ├── user-actions.ts     # フォロー・プロフィール
    │   └── community-actions.ts # コミュニティ操作
    └── error-handler.ts        # QPS制限・認証エラー専用処理
```

### データ管理統合方針
**src/data/ ディレクトリによる統合管理**
- データ管理クラス（data-manager.ts）とYAML設定ファイルを統合
- 学習データとシステム設定の一元管理
- プロジェクト構造の簡素化と管理効率向上

## 🚀 基本的なワークフロー（30分毎）

### メインループ実行順序
1. **スケジューラー起動**: 30分間隔でのシステム実行開始
2. **データ確認**: dataディレクトリから学習データ・設定読み込み
3. **状況分析**: アカウント状況・市場動向・過去データの統合分析
4. **Claude判断**: 現在状況に基づく最適アクションの決定
5. **アクション実行**: 決定されたアクション（投稿・RT・いいね等）の実行
6. **結果記録**: 実行結果の記録・学習データへの反映
7. **次回待機**: 30分後の次回実行まで待機

### エラーハンドリング
- **各段階でのtry-catch実装**
- **エラー時の安全な状態維持**
- **次回実行への影響最小化**
- **詳細エラーログの記録**

## 🎯 MVPの成功基準

### 機能要件
- [ ] 30分間隔での確実な自動実行
- [ ] 4種類のアクション（投稿・RT・引用RT・いいね）の正常動作
- [ ] dataディレクトリからの学習データ活用
- [ ] Claude Code SDKによる適切なアクション判断
- [ ] KaitoTwitterAPIによる確実なアクション実行

### 品質要件
- [ ] 投稿品質の維持（投資教育価値）
- [ ] 適切なアクション頻度・バランス
- [ ] エラー時の適切な復旧・継続実行
- [ ] 学習データの適切な蓄積・活用

### 成長指標
- [ ] エンゲージメント率: 2.0%以上維持
- [ ] フォロワー増加: 月次5%以上
- [ ] アクション成功率: 95%以上
- [ ] システム稼働率: 99%以上

## 💡 実装戦略

### 開発優先順位
1. **Week 1**: スケジューラー・データ管理・基本構造
2. **Week 2**: Claude判断エンジン・アクション実行
3. **Week 3**: KaitoTwitterAPI統合・各アクション実装
4. **Week 4**: テスト・調整・安定化

### MVP後の拡張計画
- **Clean Architecture移行**: 本格運用後の構造改善
- **高度分析機能**: 詳細なエンゲージメント分析
- **複数アクション組み合わせ**: より複雑な戦略実行
- **パフォーマンス最適化**: 応答速度・効率の改善

## 🔒 制約事項

### MVP段階の制限
- **複雑な分析機能は後回し**: 基本動作を最優先
- **Clean Architectureは将来対応**: まず動作するシステム
- **高度な最適化は段階的**: 安定動作後に実装

### 絶対要件
- **30分間隔実行の確実性**: システムの根幹機能
- **学習データの活用**: Claude判断の品質向上
- **アクション実行の信頼性**: 失敗時の適切な処理
- **継続的な改善**: 実行結果に基づく戦略進化

---

**MVPの目標**: 確実に動作し、継続的に学習・改善する30分間隔X投稿システムの実現